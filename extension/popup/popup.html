<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Allegro Analyzer</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <span class="icon">🔍</span>
        <h1>Allegro Analyzer</h1>
      </div>
      <button id="settings-btn" class="settings-btn" title="Ustawienia">⚙️</button>
    </header>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>⚙️ Ustawienia</h2>
          <button id="close-settings-btn" class="close-btn">✕</button>
        </div>
        <div class="modal-body">
          <div class="setting-group">
            <label for="api-key-input">🔑 OpenAI API Key</label>
            <input
              type="password"
              id="api-key-input"
              placeholder="sk-proj-..."
              class="api-key-input"
            />
            <small class="help-text">
              <a href="https://platform.openai.com/api-keys" target="_blank">
                Pobierz klucz API z OpenAI →
              </a>
            </small>
          </div>
          <div class="setting-group">
            <button id="save-settings-btn" class="action-button primary">
              💾 Zapisz ustawienia
            </button>
          </div>
          <div id="settings-status" class="status-message hidden"></div>
        </div>
      </div>
    </div>

    <main class="content">
      <!-- Initial message (hidden when data received) -->
      <div id="initial-message" class="message-box">
        <div class="message-icon">📊</div>
        <h2>Gotowy do analizy!</h2>
        <p class="info-text">
          Otwórz aukcję Allegro aby rozpocząć analizę i otrzymać sugestie optymalizacji.
        </p>
        <div class="instructions">
          <p><strong>Jak używać:</strong></p>
          <ol>
            <li>Przejdź do dowolnej aukcji na Allegro</li>
            <li>Kliknij przycisk "🔍 Analizuj aukcję"</li>
            <li>Otrzymaj inteligentne sugestie AI</li>
          </ol>
        </div>
      </div>

      <!-- Auction data card (shown when data received) -->
      <div id="auction-card" class="auction-card hidden">
        <div class="auction-header">
          <div class="auction-image">
            <img id="auction-thumbnail" src="" alt="Auction thumbnail">
          </div>
          <div class="auction-basic-info">
            <h3 id="auction-title">Tytuł aukcji</h3>
            <div class="auction-price">
              <span class="price-label">Cena:</span>
              <span id="auction-price" class="price-value">0 zł</span>
            </div>
          </div>
        </div>

        <div class="auction-details">
          <div class="detail-row">
            <span class="detail-label">📸 Zdjęcia:</span>
            <span id="auction-images" class="detail-value">0</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">📝 Opis:</span>
            <span id="auction-description" class="detail-value">0 znaków</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">👤 Sprzedawca:</span>
            <span id="auction-seller" class="detail-value">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">🏷️ Stan:</span>
            <span id="auction-condition" class="detail-value">-</span>
          </div>
        </div>

        <div class="auction-actions">
          <button id="analyze-again-btn" class="action-button primary">
            🔄 Analizuj ponownie
          </button>
          <button id="view-auction-btn" class="action-button secondary">
            👁️ Zobacz aukcję
          </button>
        </div>

        <!-- AI Analysis Section -->
        <div class="ai-section">
          <div class="ai-header">
            <h3>🤖 Analiza AI</h3>
            <button id="ai-analyze-btn" class="action-button ai-button">
              <span class="btn-text">Analizuj konkurencję</span>
              <span class="btn-cost">~0.05 PLN</span>
            </button>
          </div>

          <!-- AI Results (hidden by default) -->
          <div id="ai-results" class="ai-results hidden">
            <div class="ai-rating">
              <span class="rating-label">Ocena aukcji:</span>
              <div class="stars" id="ai-stars">☆☆☆☆☆</div>
              <span class="rating-value" id="ai-rating-value">0/5</span>
            </div>

            <!-- Detailed Comparison Table -->
            <div class="comparison-table">
              <h4>📊 Szczegółowe porównanie</h4>

              <!-- Price Comparison -->
              <div class="comparison-row">
                <div class="comparison-category">💰 Cena</div>
                <div class="comparison-yours">
                  <span class="label">Twoja:</span>
                  <span class="value" id="comp-your-price">-</span>
                </div>
                <div class="comparison-best">
                  <span class="label">Najniższa:</span>
                  <span class="value" id="comp-best-price">-</span>
                  <span class="indicator" id="comp-price-indicator"></span>
                </div>
              </div>

              <!-- Delivery Time -->
              <div class="comparison-row">
                <div class="comparison-category">🚚 Czas dostawy</div>
                <div class="comparison-yours">
                  <span class="label">Twój:</span>
                  <span class="value" id="comp-your-delivery">-</span>
                </div>
                <div class="comparison-best">
                  <span class="label">Najkrótszy:</span>
                  <span class="value" id="comp-best-delivery">-</span>
                  <span class="indicator" id="comp-delivery-indicator"></span>
                </div>
              </div>

              <!-- Description Quality -->
              <div class="comparison-row">
                <div class="comparison-category">📝 Jakość opisu</div>
                <div class="comparison-yours">
                  <span class="label">Twoja:</span>
                  <span class="value" id="comp-your-desc">-</span>
                </div>
                <div class="comparison-best">
                  <span class="label">Najlepsza:</span>
                  <span class="value" id="comp-best-desc">-</span>
                  <span class="indicator" id="comp-desc-indicator"></span>
                </div>
              </div>

              <!-- Photos Count -->
              <div class="comparison-row">
                <div class="comparison-category">📸 Liczba zdjęć</div>
                <div class="comparison-yours">
                  <span class="label">Twoja:</span>
                  <span class="value" id="comp-your-photos">-</span>
                </div>
                <div class="comparison-best">
                  <span class="label">Najwięcej:</span>
                  <span class="value" id="comp-best-photos">-</span>
                  <span class="indicator" id="comp-photos-indicator"></span>
                </div>
              </div>

              <!-- Shipping Cost -->
              <div class="comparison-row">
                <div class="comparison-category">📦 Koszt dostawy</div>
                <div class="comparison-yours">
                  <span class="label">Twój:</span>
                  <span class="value" id="comp-your-shipping">-</span>
                </div>
                <div class="comparison-best">
                  <span class="label">Najniższy:</span>
                  <span class="value" id="comp-best-shipping">-</span>
                  <span class="indicator" id="comp-shipping-indicator"></span>
                </div>
              </div>

              <!-- Best Competitor Link -->
              <div class="comparison-footer">
                <a href="#" id="ai-best-link" class="comparison-link" target="_blank">
                  🔗 Zobacz najlepszą aukcję konkurencji →
                </a>
              </div>
            </div>

            <div class="ai-advantages">
              <h4>✅ Kluczowe przewagi konkurencji:</h4>
              <ul id="ai-advantages-list"></ul>
            </div>

            <details class="ai-suggestions">
              <summary>📝 Pełne sugestie optymalizacji</summary>
              <div id="ai-suggestions-content" class="suggestions-content"></div>
              <button id="copy-suggestions-btn" class="action-button secondary small">
                📋 Kopiuj sugestie
              </button>
            </details>

            <details class="ai-description">
              <summary>✨ Poprawiony opis (gotowy do Allegro)</summary>
              <div id="ai-description-content" class="description-content"></div>
              <button id="copy-description-btn" class="action-button secondary small">
                📋 Kopiuj opis HTML
              </button>
            </details>

            <div class="ai-actions">
              <button id="export-pdf-btn" class="action-button secondary">
                📄 Eksportuj raport PDF
              </button>
            </div>
          </div>

          <!-- AI Loading State -->
          <div id="ai-loading" class="ai-loading hidden">
            <div class="spinner"></div>
            <p>Analizuję konkurencję za pomocą AI...</p>
            <small>To może potrwać 10-30 sekund</small>
          </div>

          <!-- AI Error State -->
          <div id="ai-error" class="ai-error hidden">
            <p class="error-message"></p>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <p>Powered by AI • v1.0.0</p>
    </footer>
  </div>

  <script src="popup.js"></script>
</body>
</html>
